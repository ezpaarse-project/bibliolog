# BiblioLog

BiblioLog is a tool for real-time viewing in the browser raw logs generated by your proxy (eg EZproxy) and usage events generated by [ezPAARSE](https://github.com/ezpaarse-project/ezpaarse).

How could it be useful ?
  * For real-time monitoring your ezproxy raw logs (lines of logs)
  * For real-time monitoring your ezproxy users activity (ezpaarse generated usage events)
  * To help you to create or update an [ezpaarse platform analysis](http://analogist.couperin.org/platforms/)
  * To test an ezpaarse handled platforms (parsers and pkb)

<p align="center">
<img src="https://raw.githubusercontent.com/ezpaarse-project/bibliolog/master/bibliolog.png" height="350px"  alt="Running bibliolog screenshot" />
</p>

BiblioLog uses these softwares:
  * [Log.io](http://logio.org/) for logs harvesting and for real-time viewing in the browser raw logs and usage events.
  * [ezpaarse2log.io](https://github.com/ezpaarse-project/ezpaarse2log.io) for real-time listening lines of log comming from log.io-harvester, creating ezPAARSE jobs to generate corresponding usage event and then sending all of this to log.io-server

<p align="center">
<img src="https://docs.google.com/drawings/d/1bkxEEBL1kLzH76dkIYFzspYHOVajDjQHCijU3mxJLnM/pub?w=694&h=519" />
</p>

## Prerequisites

  * 2 serveurs with Linux OS (ex: debian or ubuntu)
    * 1st server hosts ezproxy daemons and especially your ezproxy raw log files (assume that server ip or hostname is: **{ezproxy-server}**)
    * 2nd server hosts bibliolog (assume that server ip or hostname is: **{bibliolog-server}**)
  * Install curl and git on **{bibliolog-server}** and **{ezproxy-server}**:
```bash
sudo apt-get install curl git
```
  * Install NodeJS on **{bibliolog-server}** and **{ezproxy-server}**:
```bash
curl https://raw.githubusercontent.com/creationix/nvm/v0.5.1/install.sh | sh
nvm install 0.10
nvm use 0.10
nvm alias default 0.10
```
  * Install Log.io as a global command on **{bibliolog-server}** and **{ezproxy-server}** :
```bash
npm install -g log.io@0.3.2
```
  * Install ezpaarse on **{bibliolog-server}** and run it :
```bash
git clone https://github.com/ezpaarse-project/ezpaarse.git
cd ezpaarse/
git checkout `git describe --tags --abbrev=0`
make
make start
```

## Installation

On **{bibliolog-server}**:
```bash
git clone https://github.com/ezpaarse-project/bibliolog.git
cd bibliolog/
npm install -g forever

```


## Configuration

### log.io-server (bibliolog side)

On **{bibliolog-server}**, tells to ``log.io-server`` where to listen for bibliolog raw logs + ezpaarse usage events:

```bash
echo "exports.config = {
  host: '0.0.0.0',
  port: 28778
}" > ~/.log.io/log_server.conf
```

Then configure your ``~/.log.io/web_server.conf`` as you want. This config file tells where the Web interface should listen and if it should be password protected or not.
Config file example:
```javascript
exports.config = {
  host: '0.0.0.0',
  port: 50196,

  // Enable HTTP Basic Authentication
  auth: {
    user: "BIBLIOLOG",
    pass: "XXXX"
  },
}
```

Then open your browser and go to http://bibliolog-ip:50196/ and you will have the nice bibliolog interface displayed.

<p align="center">
<img src="https://raw.githubusercontent.com/ezpaarse-project/bibliolog/master/bibliolog.png" alt="Running bibliolog screenshot" />
</p>

## Running BiblioLog

### Start

On **{bibliolog-server}**:
```bash
./etc/init.d/bibliolog start
```

On **{ezproxy-server}**:
```bash
log-io.harvester
```

### Status

```bash
./etc/init.d/bibliolog status
```

### Stop

```bash
./etc/init.d/bibliolog stop
```

### Monitoring (log files)

```bash
tail -f ./logs/log.io-server-stderr.log
tail -f ./logs/llog.io-server-stdout.log
```
